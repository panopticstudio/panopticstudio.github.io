<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>CMU Panoptic Dataset</title>
	<link href="css/normalize.css" rel="stylesheet">
	<link type="text/css" rel="stylesheet" href="css/prism.css"/>
	
	
	<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
	<link href="css/main.css" rel="stylesheet">
		<!-- Optional theme -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css" integrity="sha384-fLW2N01lMqjakBkx3l/M9EahuwpSfeNvV63J5ezn3uZzapT0u7EYsXMjQV+0En5r" crossorigin="anonymous">

	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
	
	<!-- Latest compiled and minified JavaScript -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>

    <style>
      body {
        padding-top: 60px; /* 60px to make the container go all the way to the bottom of the topbar */
      }
    </style>
    <link href="css/bootstrap-responsive.css" rel="stylesheet">

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="../assets/js/html5shiv.js"></script>
    <![endif]-->

	<link href="css/myStyle.css " rel="stylesheet">
	<link href="css/thumbnail.css" rel="stylesheet">
	
	<script>
	  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	  ga('create', 'UA-72129944-1', 'auto');
	  ga('send', 'pageview');

	</script>
	
	<script src="js/main.js"></script>
	<script src="js/videopreview.js"></script>
	<script src="js/downLoadConf.js"></script>

		
	<script language="javascript">	
	$( document ).ready( function(){
		$('[type="checkbox"]').prop('checked', true);
		
		$('#td11').html(download_files[0].replace('_',' ').replace('_','~'));
		$('#td21').html(download_files[1].replace('_',' ').replace('_','~'));
		$('#td31').html(download_files[2].replace('_',' ').replace('_','~'));
		$('#td41').html(download_files[3].replace('_',' ').replace('_','~'));
		$('#td51').html(download_files[4].replace('_',' ').replace('_','~'));
		$('#td61').html(download_files[5].replace('_',' ').replace('_','~'));

		$('#td12').html(tarSize[0]+" GB");
		$('#td22').html(tarSize[1]+" GB");
		$('#td32').html(tarSize[2]+" GB");
		$('#td42').html(tarSize[3]+" GB");
		$('#td52').html(tarSize[4]+" GB");
		$('#td62').html(tarSize[5]+" GB");
	 
	});
	</script>
  
  
</head>
<body>
  
	
	<nav class="navbar navbar-inverse navbar-fixed-top">
	  <div class="container-fluid">
		<!-- Brand and toggle get grouped for better mobile display -->
		<div class="navbar-header">
		  <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
			<span class="sr-only">Toggle navigation</span>
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
		  </button>
		  <a class="navbar-brand" href="index.html">CMU Panoptic Studio</a>
		</div>

		<!-- Collect the nav links, forms, and other content for toggling -->
		<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
		  <ul class="nav navbar-nav">
		    <li><a href="index.html">Home<span class="sr-only">(current)</span></a></li>
			<li class="active"><a href="dataset.html">Dataset<span class="sr-only">(current)</span></a></li>
			<li><a href="people.html">People<span class="sr-only">(current)</span></a></li>
			<li><a href="tools.html">Tools<span class="sr-only">(current)</span></a></li>
		  </ul>
		</div><!-- /.navbar-collapse -->
	  </div><!-- /.container-fluid -->
	</nav>
	<div class="container">
		<div class="row">
			<div class="col-md-12">
				<ul class="breadcrumb">
					<li>
						<a href="#">Home</a> <span class="divider">/</span>
					</li>
					<li>
						<a href="#">Library</a> <span class="divider">/</span>
					</li>
					<li class="active">
						Data
					</li>
				</ul>
			</div>
		</div>
		<div class="row">
			<div class="col-md-12" style="position: static">
				<div class="catg-title">Preview</div>	
				<div class="row">
					<div class="col-md-6">
						<dl class="dl-horizontal" style="text-align: left">
							<dt>Duration:</dt>   			<dd>MM:SS (XXXX frames)</dd>
							<dt>Annotations:</dt>			<dd>Skeletons, faces, transcripts</dd>
							<dt>Audio:</dt>					<dd>Yes</dd>
							<dt>VGA cameras:</dt>			<dd>20</dd>
							<dt>HD cameras:</dt>			<dd>20</dd>
							<dt>Kinect cameras:</dt>		<dd>20</dd>
						</dl>
					</div>
					<div class="col-md-6" style="position: static">
							<div class="video-preview" data-autostart=1 data-frames="" data-source="videos/posefs4a/150129_ultimatum/preview/150129_ultimatum_preview.jpg" ></div> 	
					</div>
				</div>
			</div>
		</div>
		<div class="row">
			<div class="col-md-12">
				<div class="col-md-4">
					<div class="videoVGA">
					<video  height="198" controls>
					<!-- <source src="videos/0" type="video/mp4"> -->
					<source src="videos/posefs5a/160226_mafia1/160226_mafia1_vga_mosaic.mp4" type="video/mp4">
					Your browser does not support the video tag.
					</video>
					</div>
				</div>				
				<div class="col-md-4">
					<div class="videoHD">
					<video height="198" controls>
					<!-- <source src="videos/0" type="video/mp4"> -->
					<source src="videos/posefs5a/160226_mafia1/hd/ve31-2.mp4" type="video/mp4">
					Your browser does not support the video tag.
					</video>
					</div>
				</div>				
				<div class="col-md-4">
					<div class="videoKinect">
					<video height="198" controls>
					<source src="videos/posefs5a/160226_mafia1/kinect/160226_mafia1_kinect1.mp4" type="video/mp4">					
					Your browser does not support the video tag.
					</video>
					</div>
				</div>
			</div>
		</div>	
		<div class="row">
			<div class="col-md-12">
				<div class="catg-title">3D Preview</div>
				<table align="center">
					<tr>
						<td>
							<div id="viz3d-container"></div>
						</td>
						<td>
							<div id="viz3d-controls-container"></div>
						</td>
					</tr>
				</table>
				<script src="js/three.min.js"></script>
				<script src="js/controls/TrackballControls.js"></script>
				<script src="js/controls/OrbitControls.js"></script>
				<script src="js/Detector.js"></script>
				<script src="js/libs/stats.min.js"></script>
				<script src="js/loaders/PLYLoader.js"></script>
				<script src='js/libs/dat.gui.min.js'></script>
				 <script src="js/randomColor.js"></script>

				<link type="text/css" href="js/libs/dat-gui-light-theme.css" rel="stylesheet">

				<script type="x-shader/x-vertex" id="vertexshader">
				varying vec3 vColor;
				uniform float pointSize;
				uniform float alpha;

					void main() {
						vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );

						gl_PointSize = pointSize;

						gl_Position = projectionMatrix * mvPosition;
						vColor = color;
					}
				</script>

				<script type="x-shader/x-fragment" id="fragmentshader">
					varying vec3 vColor;
					uniform float alpha;
					void main() {

						gl_FragColor = vec4( vColor, alpha );

					}
				</script>

				<script>
					if ( ! Detector.webgl ) Detector.addGetWebGLMessage();

					var container, camera, scene, renderer, mesh;
					var params_gui;

					// Point clouds
					var pointCloud;
					var pointShaderMaterial;

					// Skeletons
					var connMat = [ [1,2], [1,4], [4,5], [5,6], [1,3], [3,7], [7,8], [8,9], [3,13],[13,14], [14,15], [1,10], [10, 11], [11, 12] ];
					var colorMat = randomColor({hue: 'pink', count: 18});
					var cross;	


					mouse = { x: 0, y: 0 },
					objects = [],
					
					count = 0,

					CANVAS_WIDTH = 720,
					CANVAS_HEIGHT = 520;
					gui = new dat.GUI({height : 4 * 32 - 1, autoPlace: false });		

					controls_container = document.getElementById( 'viz3d-controls-container' );
					controls_container.appendChild(gui.domElement);
					container = document.getElementById( 'viz3d-container' );
					// document.body.appendChild( container );

					renderer = new THREE.WebGLRenderer({antialias: true});
					renderer.setSize( CANVAS_WIDTH, CANVAS_HEIGHT );
					renderer.setClearColor( 0xFFFFFF );
					//renderer.setPixelRatio( window.devicePixelRatio );
					container.appendChild( renderer.domElement );

					scene = new THREE.Scene();

					camera = new THREE.PerspectiveCamera( 50, CANVAS_WIDTH / CANVAS_HEIGHT, 1, 1000 );				
					
					var bone_thickness = 0.06;
					var sphereGeometry = new THREE.SphereGeometry( bone_thickness, 8, 8 );
					var sphereMaterial = new THREE.MeshLambertMaterial({wireframe: false, color: 0xff8888  }); // colorMat[humanIdx]
					var boneMaterial = new THREE.MeshLambertMaterial({wireframe: false, color: 0xb8b8ff }); //colorMat[humanIdx]
					var boneGeometry = new THREE.CylinderGeometry(0.0*bone_thickness, bone_thickness, 1.0, 8, 1);

					function visSkeleton(scene,connMat,bodies,colorMat)
					{
						drawJoint(scene,bodies,colorMat);
						drawBody(scene,bodies,connMat,colorMat);
					}

					function drawJoint(scene,bodies,colorMat)
					{
						var group = new THREE.Group();
						group.name = 'joints';
						for( humanIdx = 0; humanIdx < bodies.length; humanIdx++){
							var joints = bodies[humanIdx]['joints15'];
							for( jointIdx = 0; jointIdx < joints.length; jointIdx++)
							{
								var jointMesh = new THREE.Mesh(sphereGeometry, sphereMaterial);
								jointMesh.position.set( joints[jointIdx*3],joints[jointIdx*3+1],joints[jointIdx*3+2] );
								jointMesh.name = 'joint';
								group.add(jointMesh);
							}
						}
						scene.add( group );
					}


					function drawBody(scene,bodies,connMat,colorMat)
					{
						var group = new THREE.Group();
						group.name = 'bodies';

						for( humanIdx = 0; humanIdx < bodies.length; humanIdx++){
							var joints = bodies[humanIdx]['joints15'];
							for( boneIdx = 0;  boneIdx < connMat.length; boneIdx++ )
							{
								var idxA = connMat[boneIdx][0]-1; 
								var idxB = connMat[boneIdx][1]-1;
								
								var ptA = new THREE.Vector3( joints[ idxA*3 ], joints[ idxA*3+1 ], joints[ idxA*3+2 ] );
								var ptB = new THREE.Vector3( joints[ idxB*3 ], joints[ idxB*3+1 ], joints[ idxB*3+2 ] );
														
								var boneMesh = drawBone(ptA,ptB,boneGeometry,boneMaterial);
								boneMesh.name = 'bone';
								group.add(boneMesh);
							}
						}
						scene.add( group );
					}

					function drawBone(pointX, pointY, edgeGeometry, material) 
					{
						var direction = new THREE.Vector3().subVectors(pointY, pointX);
						var orientation = new THREE.Matrix4();
						orientation.lookAt(pointX, pointY, new THREE.Object3D().up);
						orientation.multiply(new THREE.Matrix4().set(1, 0, 0, 0,
							0, 0, 1, 0,
							0, -1, 0, 0,
							0, 0, 0, 1));
						var edge = new THREE.Mesh(edgeGeometry, material);
						var scale = new THREE.Matrix4().set(1,0,0,0,
							0,direction.length(),0,0,
							0,0,1,0,
							0,0,0,1);
						pos = orientation.multiply(scale);
						var pos2 = new THREE.Matrix4().set(1,0,0,(pointX.x+pointY.x)/2,
							0,1,0,(pointX.y+pointY.y)/2,
							0,0,1,(pointX.z+pointY.z)/2,
							0,0,0,1);
						pos = pos2.multiply(pos);
						edge.applyMatrix(pos);
						return edge;
					}

					function removeEntity(name) {
						var selectedObject = scene.getObjectByName(name);
						scene.remove( selectedObject );
					}
					
									
					function zeroPad(num, places) {
					  var zero = places - num.toString().length + 1;
					  return Array(+(zero > 0 && zero)).join("0") + num;
					}
					
					function onChangeFrame() {						
							var manager = new THREE.LoadingManager();
							var plyLoader;
							var jsonLoader;
							var pointcloud;
							var skeleton_data;

							if(params_gui.showPointcloud) {
								plyLoader = new THREE.PLYLoader(manager);
							}
							if(params_gui.showSkeletons) {
								jsonLoader = new THREE.XHRLoader(manager);
							}

							manager.onLoad = function() {
								removeEntity('pointcloud');
								scene.add( pointcloud );

								removeEntity('bodies');
								removeEntity('joints');
								visSkeleton(scene,connMat,skeleton_data['bodies'],[]);
								render();
							};

							if(params_gui.showPointcloud) {
								//PLY file 
								var fileName = 'glExample/151125_mafia_complete/exportTrajStreamPly_webVersion_sampled/reconByTraj_' + zeroPad(params_gui.frameIdx+7801,8)+'.ply';
								plyLoader.load( fileName, function ( geometry ) {
									pointcloud = new THREE.Points( geometry, pointShaderMaterial );
									pointcloud.name = 'pointcloud';
								 } );
							} 
							if (params_gui.showSkeletons) {
								var filename = 'glExample/skeleton/body3DScene_' + zeroPad(params_gui.frameIdx+7801,8)+'.json';
								jsonLoader.load(filename, function (text) {
									skeleton_data = JSON.parse( text );
								});
								
							}
					}		
					function init() {

						camera = new THREE.PerspectiveCamera( 30, CANVAS_WIDTH /CANVAS_HEIGHT, 1, 1000 );
						camera.up.set( 0, -1, 0 );

						camera.position.x = -14;
						camera.position.y = -12.5;
						camera.position.z = 11;

						controls = new THREE.TrackballControls(camera, container);

						controls.rotateSpeed = 1.0;
						controls.zoomSpeed = 1.2;
						controls.panSpeed = 0.8;
						controls.dynamicDampingFactor = 0.5;
						//controls.keys = [ 65, 83, 68 ];
						controls.addEventListener( 'change', render );

						// world
						scene = new THREE.Scene();
						scene.position.set( 6.294, -1.193, -2.466 );
						 
						// lights
						light = new THREE.DirectionalLight( 0x888888 );
						light.position.set( 0, -10, 0 );
						scene.add( light );

						light = new THREE.DirectionalLight( 0x888888 );
						light.position.set( 0, -10, 0 );
						scene.add( light );

						light = new THREE.AmbientLight( 0x666666 );
						scene.add( light );

						// FLOOR
						var texLoader = new THREE.TextureLoader();
						var floorTexture;
						texLoader.load('img/checkerboard.jpg', function(tex) {
							floorTexture = tex;
							floorTexture.wrapS = floorTexture.wrapT = THREE.RepeatWrapping; 
							floorTexture.repeat.set( 5, 5 );
							var floorMaterial = new THREE.MeshBasicMaterial( { map: floorTexture, side: THREE.DoubleSide } );
							// var floorGeometry = new THREE.PlaneGeometry(100, 100, 10, 10);
							var floorGeometry = new THREE.CircleGeometry(5, 18);
							var floor = new THREE.Mesh(floorGeometry, floorMaterial);
							floor.position.x = -6.294;
							floor.position.y = 4;
							floor.position.z = 2.466;
							floor.rotation.x = Math.PI / 2;
							scene.add(floor);		
							render();
						});

						//GUI params
						params_gui = 
						{
							frameIdx: 1,
							pointSize: 0.1,
							alpha: 0.75,
							showPointcloud: true,
							showSkeletons: true
						};	

						pointShaderMaterial = new THREE.ShaderMaterial( {
							uniforms: {
								"pointSize": { type: "f", value: params_gui.pointSize },
								"alpha":{ type: "f", value: params_gui.alpha},
							},						
							vertexColors: THREE.VertexColors,
							vertexShader:   document.getElementById( 'vertexshader' ).textContent,
							fragmentShader: document.getElementById( 'fragmentshader' ).textContent,
							transparent:    true,
						});


						//GUI												 
						gui.add( params_gui, 'frameIdx').max(500).min(1).step(1).name( 'Frame' ).onChange(function(){ 
							onChangeFrame();	
						} );					
											
						gui.add( params_gui, 'pointSize', 0.01, 10, 0.01 ).name( 'PointSize' ).onChange(function(){
							pointShaderMaterial.uniforms.pointSize.value  = params_gui.pointSize;
							render();
						} );
						
						gui.add( params_gui, 'alpha', 0.1, 1, 0.1 ).listen().name( 'Alpha' ).onChange(function(){
							pointShaderMaterial.uniforms.alpha.value = params_gui.alpha;
							render();
						} );

						gui.add(params_gui,'showPointcloud', true).listen().name("Load Point Cloud").onChange(function(newValue) {
							onChangeFrame();
						});
						
						gui.add(params_gui, 'showSkeletons', true).listen().name("Load Skeleton").onChange(function(newValue) {
							onChangeFrame();
						});

						window.addEventListener( 'resize', onWindowResize, false );

						// Load initial frame
						onChangeFrame();
					}

					init();
					animate();

					function onWindowResize() {

						camera.aspect = CANVAS_WIDTH / CANVAS_HEIGHT;
						camera.updateProjectionMatrix();

						renderer.setSize( CANVAS_WIDTH, CANVAS_HEIGHT );

						controls.handleResize();

						render();

					}

					function animate() {

						requestAnimationFrame( animate );
						controls.update();

					}

					function render() {
						renderer.render( scene, camera );
					}

				</script>	
			</div>
		</div>	
		<div class="row">
			<div class="col-md-12">
				<div class="catg-title">Download the sequence</div>
				<p> We recommend that you first select the desired parts of the dataset and then generate the batch download script to download. </p>
				<div id="stats-table">
				<table class="table table-hover" align="center">
				<tr>
					<td align="center"><input type="checkbox" id="selectall"/></th>
					<th>Options</th>
					<th>Size</th>
				</tr>
				<tr>
					<td align="center"><input type="checkbox" class="case" name="case" value="1"/></td>
					<td id="td11">VGA 1~10</td>
					<td id="td12">1.2TB</td>
				</tr>
				<tr>
					<td align="center"><input type="checkbox" class="case" name="case" value="2"/></td>
					<td id="td21">VGA 11~20</td>
					<td id="td22">1.5TB</td>
				</tr>
				<tr>
					<td align="center"><input type="checkbox" class="case" name="case" value="3"/></td>
					<td  id="td31">HD 1~14</td>
					<td  id="td32">2.5TB</td>
				</tr>
				<tr>
					<td align="center"><input type="checkbox" class="case" name="case" value="4"/></td>
					<td id="td41">HD 15~28</td>
					<td id="td42">2.8TB</td>
				</tr>
				<tr>
					<td align="center"><input type="checkbox" class="case" name="case" value="5"/></td>
					<td id="td51">Kinect 1~5</td>
					<td id="td52">4 TB</td>
				</tr>
				<tr>
					<td align="center"><input type="checkbox" class="case" name="case" value="6"/></td>
					<td id="td61">Kinect 6~10</td>
					<td id="td62">0 TB</td>
				</tr>
				</table>
				</div>
				<div class="wrapper">
				<button class="btn btn-default" id="download">Download Selected</button>
				<button class="btn btn-primary" id="generate_bat">Download Script(Windows)</button>
				<button class="btn btn-primary" id="generate_sh">Download Script(Linux)</button>
				</div>
			</div>
		</div>	

		<div class="row">
			<div class="col-md-12">
				<div class="catg-title">License</div>	  
					<p>If you use any of the data, please cite our paper.</p>
				</div>
			</div>
		</div>	

  <script src="js/jquery.min.js"></script>
  <script src="js/main.js"></script>
  <script src="js/videopreview.js"></script>

</body>
</html>